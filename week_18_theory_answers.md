Ответы на вопросы восемнадцатой недели.

1. **_Сколько живет localStorage?_**

Local Storage не имеет ограничений по времени хранения и данные в нём должны храниться бессрочно (сохраняются после перезапуска браузера и даже ОС), но браузеры вводят свои ограничения.
При переполнении хранилища оно автоматически полностью очищается браузером. Также может быть очищено пользователем вручную.

Можно использовать два способа хранения данных — _временный_ и _постоянный_. Во _временном_ режиме браузер может удалить данные (если этот процесс не помешает работе пользователя). В _постоянном_ режиме этого не случится, даже в случае нехватки места (но в этом режиме пользователь всё ещё может самостоятельно очищать хранилище).
По умолчанию все хранилища работают во временном режиме. Если сайт не запросил постоянное хранение данных, то браузер может удалить его данные по своему усмотрению.

При автоматической очистке места браузеры должны удалить наименее ценные для пользователя данные.

-   Браузеры на основе Chromium освобождают место последовательно, удаляя данные сайтов. Удаление начинается с сайтов, которые давно не посещались, и продолжается пока не освободится достаточно места.
-   Internet Explorer 10+ не очищает данные, но при этом не даёт записывать данные сверх лимита.
-   Firefox начинает очистку, когда заканчивается свободное место на диске. Порядок удаления определяется по тому же принципу, что и в браузерах на основе Chromium.
-   Safari (на основе движка WebKit) раньше вообще не удалял данные, но сейчас очищает Local Storage, если к нему не обращались в течение семи дней.

2. **_Как посмотреть localStorage в браузере?_**

В _Chrome_ для этого нужно открыть панель разработчика в браузере, перейти во вкладку _Application_ и в разделе _Storage_ можно увидеть _Local Storage_.
В _Firefox_ нужно открыть панель разработчика, перейти во вкладку _Хранилище_ (Инспектор хранилища) и там можно увидеть _Локальное Хранилище_.

Так можно посмотреть информацию только об активной веб-странице, а не о других сайтах в браузере.

3. **_Можно ли хранить данные пользователя в sessionStorage?_**

Да, можно (но только до момента, пока открыта текущая вкладка).

Объект веб-хранилища sessionStorage используется гораздо реже, чем localStorage, потому что привязан не только к источнику (домен/протокол/порт), но и к вкладке браузера.

sessionStorage существует только в рамках текущей вкладки браузера. Другая вкладка с той же страницей будет иметь другое хранилище.
Данные продолжают существовать после перезагрузки страницы, но не после закрытия/открытия вкладки.

4. **_Как очистить локальное хранилище в браузере?_**

Метод `clear()` очищает хранилище полностью.

```javascript
window.localStorage.clear();
```

Но лучше так не делать, а использовать `removeItem` для удаления определенных записей из хранилища.
`removeItem('ключ')` удаляет запись из хранилища. Он успешно выполнится даже если указанного ключа не существует в хранилище.

```javascript
window.localStorage.removeItem("name");
window.localStorage.removeItem("user");
```

Это можно сделать и вручную.

Для очистки локального хранилища в Chrome:
На странице сайта открыть _Инструменты Разработчика_ (F12) >> раздел _Приложения_ (Application) >> подраздел _Хранилище_ (Storage) >> _Очистить данные сайта_ (Clear site data).

Для очистки локального хранилища в Firefox:
На странице сайта открыть _Инструменты Разработчика_ (F12) >> раздел _Хранилище_ >> развернуть _Локальное Хранилище_ и, кликнув правой кнопкой мыши, выбрать _Удалить всё_.

5. **_Для чего нужны и какая польза от использования куки и localStorage/sessionStorage?_**

При разработке современных веб-сайтов достаточно часто необходимо сохранять данные на стороне клиента. Для таких целей в браузере существует несколько разных способов.

_Куки (cookie)_ — это небольшие строки данных, которые хранятся непосредственно в браузере. Эту информацию можно добавлять, изменять и удалять непосредственно из программного кода сайта.

Этот способ — не просто хранилище данных в браузере. Данные, хранящиеся в куках, также передаются на сервер в виде HTTP-заголовка и могут быть им изменены. Это накладывает на них ограничения. Например, максимальный размер куки в 4096 байт или отсутствие в содержимом пробелов или запятых.

У хранения данных в Cookie есть много ограничений. Они передаются при каждом запросе к серверу, их размер ограничен 4096 байтами, а содержимое должно быть закодировано и быть безопасным, чтобы не сломать отправляемый запрос. Cookie не являются постоянным хранилищем, срок хранения данных по умолчанию ограничен длинной сессии, и для продления хранения кук используется дополнительный параметр.

Как правило, Cookie используются, когда часть информации (например, токен авторизации или данные пользователя) нужно хранить и читать как в браузере, так и на сервере. Ещё куки используются для отслеживания поведения пользователя на сайте, но браузеры активно с этим борются.

К сожалению, в куки можно хранить очень ограниченное количество информации, поэтому для хранения больших значений лучше использовать localStorage.

_Веб-хранилище_ (локальное хранилище) предоставляет веб-приложениям и страницам возможность хранить данные локально в веб-браузерах.
Максимальный объем хранимых данных — 5 Мб. При этом любой скрипт, загруженный на странице, может иметь доступ к Web Storage на этой странице.

В localStorage данные хранятся даже после закрытия страницы, и к ним можно вернуться в любой момент.
Объект localStorage доступен всем окнам из одного источника, поэтому, если мы устанавливаем данные в одном окне, изменения становятся видимыми в другом.

При помощи localStorage можно сохранять данные, относящиеся к пользователю, не храня их на сервере. Например, запоминать размер шрифта на сайте и восстанавливать размер из хранилища, если он был изменён до этого. Можно использовать для синхронизации нескольких открытых в браузере вкладок. При изменении размера шрифта в одной вкладке мы узнаем об этом во всех остальных и тоже изменим размер.

Если данные нужно хранить только до тех пор, пока открыта вкладка, а после её закрытия пользователем их можно удалять, но, например, обращаться к этим данным нужно из разных скриптов на одной странице, то можно использовать sessionStorage.
SessionStorage — это временное хранилище данных в браузере (после закрытия вкладки все данные в sessionStorage автоматически удаляются).

Чаще всего sessionStorage используют для хранения данных неавторизованных пользователей в простых интернет-магазинах: что он смотрел, что положил в корзину.

Когда нет проверки актуальности данных, то неоконченный заказ лучше хранить в sessionStorage. При закрытии вкладки данные удаляются и в следующий раз пользователю не будет показан его прошлый незаконченный заказ, как если бы он хранился в localStorage. Например, при заказе из ресторана чего-то может уже не быть в наличии или поменялось меню.

Ещё sessionStorage иногда используют для временного хранения пользовательских данных в формах. Например, человек заполняет адрес доставки и случайно нажимает Перезагрузить. Тогда данные должны подтянуться из sessionStorage.

6. **_Как работать с cookie?_**

Все куки хранятся в свойстве `document.cookie`. Это свойство представляет собой строку в формате `имя=значение`, где пары имён и значений разделяются знаком `;` . При этом взаимодействие с полем весьма необычное — если присвоить `document.cookie` новое значение, то оно не заменит полностью старую строку, а добавит или изменит значение по ключу. За один раз можно записать лишь одно значение.

Вот так можно добавить значение 1 по ключу counter:

```javascript
document.cookie = "counter=1";
console.log(document.cookie);
// 'counter=1'
```

Запись в `document.cookie` обновит только упомянутые в ней куки, но при этом не затронет все остальные.

У куки есть ряд настроек, многие из которых важны и должны быть установлены.
Эти настройки указываются после пары `ключ=значение` и отделены друг от друга разделителем `;` (все они являются необязательными):

• `path` определяет путь, по которому будет доступна кука. Он должен быть абсолютным, то есть начинаться с `/`. Если параметр не передан, то кука будет доступна на всех страницах сайта.

```javascript
document.cookie = "user=Anie; path=/mypath";
```

Как правило, указывают в качестве пути корень `path=/`, чтобы наше куки было доступно на всех страницах сайта.

• `domain` определяет домен, для которого указана кука. Если не указано, то будет использоваться текущий домен.

Опция `domain` позволяет нам разрешить доступ к куки для поддоменов, для этого надо установить параметр `domain` для корневого домена: `domain=site.com` (для поддержки очень старых браузеров можно использовать запись с точкой перед названием домена `domain=.site.com`).

```javascript
document.cookie = "user=Ann; domain=site.com";
```

• `max-age` и `expires` определяет время жизни куки. `max-age` указывает, через сколько секунд, а `expires` указывает точное время, когда кука станет недействительна. Время для expires можно отформатировать с помощью встроенного метода даты `Date.toUTCString()`

```javascript
// установим срок действия куки на 1 день (+1 день от текущей даты)
let date = new Date(Date.now() + 86400e3);
date = date.toUTCString();
document.cookie = "user=Anna; expires=" + date;
```

Для кук не предусмотрено специального метода удаления.
Если мы установим в expires прошедшую дату, то куки будет удалено.

`max-age` определяет срок действия куки в секундах с текущего момента.
Если задан ноль или отрицательное значение, то куки будет удалено:

```javascript
// куки будет удалено через 1 час
document.cookie = "user=Hannah; max-age=3600";

// удалим куки (срок действия истекает прямо сейчас)
document.cookie = "user=Hannah; max-age=0";
```

По умолчанию, если куки не имеют ни одного из этих параметров, то они удалятся при закрытии браузера. Такие куки называются сессионными (_session cookies_).

• `secure` указывает, что данная кука может быть передана только при запросах по защищённому протоколу HTTPS.

С этой настройкой, если куки будет установлено на сайте `https://site.com`, то оно не будет доступно на том же сайте с протоколом HTTP, как `http://site.com`

```javascript
document.cookie = "user=John; secure";
```

• `samesite` определяет, может ли данная кука быть отправлена при кросс-доменном запросе. Значение параметра `strict` будет предотвращать отправку на другие домены, а `lax` разрешит отправлять куки с GET-запросами.
`samesite=strict` — то же самое, что `samesite` без значения;
режим `samesite=lax`, позволяет самой распространённой операции "переход по ссылке" передавать куки (например, открытие сайта из заметок удовлетворяет этим условиям).
Эта настройка безопасности применяется для защиты от XSRF-атаки (Cross-Site Request Forgery — межсайтовая подделка запроса).

Чтобы получить значение конкретной куки, достаточно разбить строку из `document.cookie` по `;`, и затем найти нужный ключ. Для этого мы можем использовать как регулярные выражения, так и функции для обработки массивов.

Cookie имеют не самый удобный интерфейс чтения и записи, поэтому в работе многие разработчики чаще используют сторонние библиотеки (например, _js-cookie_), а не взаимодействуют с интерфейсом напрямую.

Есть куки, которые нельзя прочитать или записать из JavaScript. Если сервер устанавливает куки с параметром HttpOnly (доступен только для установки сервером), то такие куки будут недоступны в `document.cookie`. Как правило, такие куки используются для хранения чувствительной информации, как, например, токены для авторизации. Проверка авторизации происходит с помощью запроса с текущим авторизованным пользователем и считается при успешном ответе сервера.

7. **_Как добавить и получить значение из веб-хранилища?_**

Объекты хранилища localStorage и sessionStorage предоставляют одинаковые методы для записи и получения данных:
`setItem(key, value)` — сохранить пару ключ/значение.
`getItem(key)` — получить данные по ключу key.

Для записи используется метод `setItem('ключ', 'значение')`. Он принимает два строковых параметра: ключ, по которому будет сохранено значение, и само значение.

```javascript
// Запись в поле
window.localStorage.setItem("name", "Анна");
window.sessionStorage.setItem("name", "Ханна");
```

За чтение отвечает `getItem('ключ')` c одним параметром, который указывает на ключ для чтения и возвращает полученное значение из хранилища. Если по этому ключу нет значения, то метод вернёт `null`.

```javascript
window.localStorage.getItem("name"); // вернет 'Анна'
window.localStorage.getItem("user"); // вернет null
```

```javascript
// Чтение из поля
const nameFromLocalStorage = window.localStorage.getItem("name");
console.log(nameFromLocalStorage); // Анна
const nameFromSessionStorage = window.sessionStorage.getItem("name");
console.log(nameFromSessionStorage); // Ханна
```

Данные записываются в виде строк, поэтому если нам надо сохранить сложную структуру, то сначала нужно сделать из неё строку с помощью `JSON.stringify()` и только после этого записывать.

8. **_Придумайте ещё минимум 3 ситуации, помимо предложенных в уроке, для чего может быть нужно сохранять данные пользователя и какие?_**

    _Пример из урока: запомнить, что пользователь уже залогинился, что у него лежит в корзине или в каком разделе сайта он сейчас находится_

-   Размер шрифта на сайте
-   Темная или светлая тема
-   Ранее выбранный город (местоположение)
-   Товары, добавленные к сравнению
-   Товары, просмотренные пользователем ранее
-   Запросы в поиске по сайту

9. **_Какие преимущества использования JSON?_**

JSON (JavaScript Object Notation) - это формат передачи данных, который широко используется в веб-разработке. Он был разработан для удобства обмена данными между клиентом и сервером, и является текстовым форматом, основанным на синтаксисе языка JavaScript.

Основное преимущество использования JSON заключается в том, что он легко читается как человеком, так и машиной, и может быть использован для представления любых типов данных, включая массивы, объекты, числа, строки, логические значения и null.

JSON может быть использован в различных сценариях веб-разработки, включая передачу данных между клиентом и сервером, хранение данных на сервере, а также для обмена данными между различными приложениями и системами.

JSON может быть использован с любым языком программирования, а не только с JavaScript, что делает его очень гибким и универсальным форматом данных. Большинство современных языков программирования имеют библиотеки для работы с JSON, что упрощает его использование в различных сценариях.

До создания формата JSON веб-сайты работали медленно. Каждый запрос пользователя к серверу требовал повторной отправки в браузер обновленной HTML-страницы. AJAX-запрос, использующий формат JSON, выполняется в фоновом режиме, поэтому страница не перезагружается. Сегодня JSON — это стандарт передачи данных в интернете.

JSON — это компактный формат. С ним большие объемы данных быстро обмениваются между браузером и веб-сервером.

Правила создания JSON-файла обеспечивают надежность и скорость реализации алгоритма кодирования и чтения.

С точки зрения безопасности данных JSON лучше, чем XML, но всё равно нужна проверка данных перед их использованием.

Хранение и экспорт данных в JSON поддерживают современные реляционные базы данных, такие как PostgreSQL и MySQL. 10. Какие значения могут быть использованы в JSON?

JSON состоит из пар ключ-значение. Пары разделяются между собой запятыми — ,, а ключ отделяется от значения через двоеточие — :. Ключом может быть только строка, обёрнутая в двойные кавычки. А вот значением — почти всё что угодно.

Значениями в JSON могут быть следующие типы данных:

JSON-объекты — неупорядоченные множества пар «ключ:значение», разделенные запятыми;
массивы — упорядоченные коллекции значений, заключенные в квадратные скобки, значения разделены запятыми;
примитивы:
числа — целые или с плавающей запятой;
логический тип данных — true и false;
строки — заданные последовательности из символов Юникода (стандарт кодирования символов), заключенные в две двойные кавычки;
значение Null — показывает отсутствие информации.

JSON является независимой от языка спецификацией для данных, поэтому JSON.stringify пропускает некоторые специфические свойства объектов JavaScript:
Свойства-функции (методы).
Символьные ключи и значения.
Ключи со значением undefined.

Объект в формате JSON имеет несколько важных отличий от объектного литерала:
Строки используют двойные кавычки. Никаких одинарных кавычек или обратных кавычек в JSON. Так 'Ann' становится "Ann".
Имена свойств объекта также заключаются в двойные кавычки. Это обязательно. Так age:35 становится "age":35.

JSON не поддерживает комментарии. Добавление комментария в JSON делает его недействительным.

11. **_Как брать данные из JSON?_**

С помощью операции, которая называется десериализацией или парсингом.
Преобразовать JSON-объект в JavaScript можно с помощью метода `JSON.parse()`. Он принимает JSON-строку в качестве аргумента. С помощью `JSON.parse()` мы получим стандартный объект, с которым можно взаимодействовать.

В случае, если строка не является валидным JSON-кодом, метод `JSON.parse()` выдаст ошибку SyntaxError.
